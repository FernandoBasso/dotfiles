#!/usr/bin/env bash

script_dir="$( cd "$(dirname "$0")" && pwd -P )"

symlink () {
  # Source dir, relative to `script_dir' and destination dir
  # relative to `$HOME'.
  dir="$1"

  # The filename to be symblinked.
  file="$2"

  # Start building the path for the original file.
  origfile="$script_dir"

  # Start building the path for the target/destination file.
  target="$HOME"

  # If `dir' has a value, it means the file to be symblinked
  # directly in `$HOME', but in a subdirectory of `$HOME' and
  # we have to update the variables with that `dir'.
  if [ -n "$dir" ] ; then
    origfile+="/$dir"
    target+="/$dir"
  fi

  # Create the directories. `-p' only creates directories if they
  # don't already exist. No damage can be done with this command.
  mkdir -pv "$target"

  # Now that we used the paths to create the directories we can
  # finally add the file itself to be symblinked on those paths.
  origfile+="/$file"
  target+="/$file"

  if [ ! -L "$target" ] ; then
    if [ -e "$target" ] ; then
      printf '%s\n' "[WARNING]: $target exists and is not a symblink..."
    else
      ln -sv "$origfile" "$target"
    fi
  fi

}

deploy () {
  while read -r line ; do
    file=$( printf '%s' "$line" | cut -d '|' -f 1 )
    dir=$( printf '%s' "$line" | cut -d '|' -f 2 )
    symlink "$dir" "$file"
  done < ./MANIFEST-LINUX.txt
}


deploy "$script_dir/MANIFEST-LINUX.txt"

# vim: set tabstop=2 softtabstop=2 shiftwidth=2:

